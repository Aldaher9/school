<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <style>
        :root { --primary: #1a5f7a; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; text-align: right; }
        .navbar { background: var(--primary); color: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn-settings { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .container { max-width: 1000px; margin: 30px auto; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--primary); }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8f9fa; padding: 12px; border-bottom: 2px solid var(--primary); text-align: center; }
        td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
        select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #3498db; }
        .btn-action { background: var(--accent); color: white; padding: 15px 30px; border: none; border-radius: 50px; cursor: pointer; display: block; margin: 20px auto; font-size: 18px; font-weight: bold; width: 100%; max-width: 300px; transition: 0.3s; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:flex-start; padding-top: 50px; overflow-y: auto; }
        .modal-content { background:white; padding:40px; border-radius:15px; width:90%; max-width: 800px; position: relative; }
        .close-modal { position: absolute; top: 20px; left: 20px; font-size: 30px; cursor: pointer; }
        .report-body { border: 1px solid #eee; padding: 30px; }
        .section-title { background: #f0f4f8; padding: 10px; border-right: 5px solid var(--primary); margin: 20px 0 10px 0; font-weight: bold; }
        .rec-box { background: #fffcf0; border: 1px solid #f1c40f; padding: 20px; border-radius: 8px; margin-top: 20px; line-height: 1.8; }
        @media print { .no-print { display: none !important; } .modal { position: absolute; display: block; } }
    </style>
</head>
<body>

<div class="navbar no-print">
    <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ© Ø§Ù„Ø°ÙƒÙŠ</h2>
    <button class="btn-settings" onclick="openImportModal()">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
</div>

<div class="container">
    <div class="card no-print">
        <div class="grid">
            <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</label><input type="text" id="tName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…"></div>
            <div class="form-group"><label>Ø§Ù„ØµÙ</label><input type="text" id="tClass" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØµÙ"></div>
            <div class="form-group"><label>Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø³</label><input type="text" id="tLesson" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³"></div>
        </div>
    </div>

    <div class="card no-print">
        <h3 id="tableStatus">ğŸ“‹ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
        <table id="evalTable" style="display:none">
            <thead><tr><th style="text-align: right;">Ø§Ù„Ø¨Ù†Ø¯ / Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</th><th style="width: 200px;">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
        <div id="msg" style="text-align:center; color:#888; padding: 20px;">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù 123.json Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡</div>
    </div>

    <button class="btn-action no-print" onclick="prepareAndShowReport()">ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</button>
</div>

<div id="importModal" class="modal no-print" style="align-items: center;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
        <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª</h3>
        <input type="file" id="fileInput" accept=".json" style="margin: 20px 0;">
        <button class="btn-action" style="width: 100%;" onclick="processFile()">ØªØ­Ù…ÙŠÙ„ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø©</button>
        <p id="statusMsg" style="margin-top: 10px;"></p>
        <button onclick="closeModal('importModal')" style="background:none; border:none; color:red; cursor:pointer; margin-top:10px;">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close-modal no-print" onclick="closeModal('reportModal')">&times;</span>
        <div class="report-body" id="printArea">
            <div class="report-header" style="text-align: center;">
                <h1 style="margin:0;">ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø© ÙÙ†ÙŠØ©</h1>
                <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…</p>
            </div>
            
            <div class="grid" style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <p><b>Ø§Ù„Ù…Ø¹Ù„Ù…:</b> <span id="r_name"></span></p>
                <p><b>Ø§Ù„ØµÙ:</b> <span id="r_class"></span></p>
                <p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> <span id="r_date"></span></p>
            </div>

            <div class="section-title">â­ Ø£ÙˆÙ„Ø§Ù‹: Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¯Ø© ÙˆØ£Ø¯Ù„ØªÙ‡Ø§</div>
            <div id="r_strengths"></div>

            <div class="section-title">ğŸ“‰ Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¬ÙˆØ§Ù†Ø¨ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ·ÙˆÙŠØ± ÙˆØ£Ø¯Ù„ØªÙ‡Ø§</div>
            <div id="r_weakness"></div>

            <div class="section-title">ğŸ’¡ Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„ØªÙˆØµÙŠØ§Øª</div>
            <div class="rec-box" id="r_recs"></div>
        </div>
        <button class="btn-action no-print" onclick="window.print()" style="margin-top: 20px; background: #333;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø£Ùˆ Ø­ÙØ¸ PDF</button>
    </div>
</div>

<script>
    let rawDatabase = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† Ù…Ù„Ù JSON

    function openImportModal() { document.getElementById('importModal').style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function processFile() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø±Ù…ÙˆØ² BOM ÙˆØ§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
                let content = e.target.result.replace(/[\uFEFF\u200B-\u200D]/g, "");
                rawDatabase = JSON.parse(content);
                
                renderTable();
                document.getElementById('statusMsg').innerHTML = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ " + rawDatabase.length + " Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­.";
                setTimeout(() => closeModal('importModal'), 1000);
            } catch (err) { 
                alert("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© JSON ØµØ­ÙŠØ­Ø©."); 
                console.error(err);
            }
        };
        reader.readAsText(file);
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù
        const keyName = Object.keys(rawDatabase[0]).find(k => k.includes("Ø§Ù„Ù…Ø¹ÙŠØ§Ø±"));
        const uniqueBenchmarks = [...new Set(rawDatabase.map(d => d[keyName]))].filter(x => x);

        tbody.innerHTML = uniqueBenchmarks.map((name, index) => `
            <tr>
                <td style="text-align: right;">${name}</td>
                <td>
                    <select class="score-input" data-benchmark="${name}">
                        <option value="3">3 - Ù…Ù„Ø§Ø¦Ù…</option>
                        <option value="1">1 - Ù…ØªÙ…ÙŠØ²</option>
                        <option value="2">2 - Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
                        <option value="4">4 - ØºÙŠØ± Ù…Ù„Ø§Ø¦Ù…</option>
                        <option value="5">5 - ÙŠØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„</option>
                    </select>
                </td>
            </tr>`).join('');
            
        document.getElementById('evalTable').style.display = 'table';
        document.getElementById('msg').style.display = 'none';
    }

    function prepareAndShowReport() {
        const name = document.getElementById('tName').value;
        if (!name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…");

        const inputs = document.querySelectorAll('.score-input');
        let excelItems = []; // Ù…ØªÙ…ÙŠØ² ÙˆØ¬ÙŠØ¯ Ø¬Ø¯Ø§
        let devItems = [];   // ØºÙŠØ± Ù…Ù„Ø§Ø¦Ù… ÙˆÙŠØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„
        let recommendations = [];

        inputs.forEach(input => {
            const score = input.value;
            const benchName = input.dataset.benchmark;

            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù† Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹ÙŠØ§Ø± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±
            const match = rawDatabase.find(item => {
                const kBench = Object.keys(item).find(k => k.includes("Ø§Ù„Ù…Ø¹ÙŠØ§Ø±"));
                const kJudge = Object.keys(item).find(k => k.includes("Ø§Ù„Ø­ÙƒÙ…"));
                return item[kBench] === benchName && item[kJudge].includes(`(${score})`);
            });

            if (match) {
                const descKey = Object.keys(match).find(k => k.includes("Ø§Ù„ÙˆØµÙ"));
                const recKey = Object.keys(match).find(k => k.includes("Ø§Ù„ØªÙˆØµÙŠØ§Øª"));
                
                const entry = { text: match[descKey], rec: match[recKey] };
                
                if (score <= 2) excelItems.push(entry);
                else if (score >= 4) devItems.push(entry);
                
                if (match[recKey]) recommendations.push(match[recKey]);
            }
        });

        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        document.getElementById('r_name').innerText = name;
        document.getElementById('r_class').innerText = document.getElementById('tClass').value;
        document.getElementById('r_date').innerText = new Date().toLocaleDateString('ar-OM');

        // Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ 3 Ø¬ÙˆØ§Ù†Ø¨ Ø¥Ø¬Ø§Ø¯Ø©
        document.getElementById('r_strengths').innerHTML = excelItems.slice(0, 3).map(i => `<p>â€¢ ${i.text}</p>`).join('') || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
        
        // Ø¹Ø±Ø¶ Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„ØªØ·ÙˆÙŠØ±
        document.getElementById('r_weakness').innerHTML = devItems.map(i => `<p>â€¢ ${i.text}</p>`).join('') || "Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¶Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©";

        // ØµÙŠØ§ØºØ© Ø§Ù„ØªÙˆØµÙŠØ§Øª
        let recHTML = `<p><b>Ø£Ø´ÙƒØ± Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø­ØµØ© ÙˆØ£ÙˆØµÙŠÙ‡ Ø¨Ø§Ù„ØªØ§Ù„ÙŠ:</b></p><ul>`;
        [...new Set(recommendations)].slice(0, 3).forEach(r => {
            recHTML += `<li>${r}</li>`;
        });
        recHTML += `</ul>`;
        document.getElementById('r_recs').innerHTML = recHTML;

        document.getElementById('reportModal').style.display = 'flex';
    }
</script>
</body>
</html>
